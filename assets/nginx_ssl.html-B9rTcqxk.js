import{_ as i,c as n,e as a,o as e}from"./app-CZuB-rTn.js";const l={};function t(p,s){return e(),n("div",null,s[0]||(s[0]=[a(`<h1 id="nginx-配置-ssl" tabindex="-1"><a class="header-anchor" href="#nginx-配置-ssl"><span>Nginx 配置 ssl</span></a></h1><p>如果你的网站是 Nginx 服务，并且需要访问的时候带上 https，那么就需要在 Nginx 配置 ssl</p><h2 id="生成-ssl-证书" tabindex="-1"><a class="header-anchor" href="#生成-ssl-证书"><span>生成 ssl 证书</span></a></h2><p>Nginx 配置需要证书和密钥，可以去阿里云或者腾讯云等服务商获取证书，一般是申请域名的时候也一并申请证书，这些证书都是互联网可信任的证书，当然，如果你的系统是运行在内网或者一些其他局域网，根本也不需要验证证书的可用性，就是单纯的使用 https，那么，就可以选择自己生成</p><h3 id="windows-准备" tabindex="-1"><a class="header-anchor" href="#windows-准备"><span>Windows 准备</span></a></h3><ol><li>生成证书的方式有很多种，这里默认已经下载了最新的 <a href="https://github.com/git-for-windows/git/releases/download/v2.46.0.windows.1/Git-2.46.0-64-bit.exe" target="_blank" rel="noopener noreferrer">Git</a>，就可以使用 <code>Git Bash</code> 下面的功能 <code>openssl</code></li></ol><h3 id="linux-准备" tabindex="-1"><a class="header-anchor" href="#linux-准备"><span>Linux 准备</span></a></h3><ol><li>需要系统有 openssl</li><li>需要 nginx 有安装 ssl 模块</li></ol><div class="hint-container tip"><p class="hint-container-title">提示</p><p><a href="https://www.cnblogs.com/echohye/p/16722833.html" target="_blank" rel="noopener noreferrer">参考</a></p></div><h3 id="openssl" tabindex="-1"><a class="header-anchor" href="#openssl"><span>openssl</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> req</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -x509</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -nodes</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -days</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3650</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -newkey</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rsa:2048</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -keyout</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> server.key</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -out</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> server.crt</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -config</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> req.cnf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -sha256</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>参数说明：</p><ul><li>req：大致有3个功能：生成证书请求文件、验证证书请求文件和创建根CA</li><li>-x509：说明生成自签名证书</li><li>-nodes：<code>openssl req</code> 在自动创建私钥时，将总是加密该私钥文件，并提示输入加密的密码。可以使用 <code>-nodes</code> 选项禁止加密私钥文件</li><li>-days：指定所颁发的证书有效期</li><li>-newkey：实际上，<code>-x509</code> 选项和 <code>-new</code> 或 <code>-newkey</code> 配合使用时，可以不指定证书请求文件，它在自签署过程中将在内存中自动创建证书请求文件,<code>-newkey</code> 选项和 <code>-new</code> 选项类似，只不过 <code>-newkey</code> 选项可以直接指定私钥的算法和长度，所以它主要用在 <code>openssl req</code> 自动创建私钥时</li><li><code>rsa:2048</code>：<code>rsa</code> 表示创建 <code>rsa</code> 私钥，<code>2048</code> 表示私钥的长度</li><li>-keyout：指定私钥保存位置</li><li>-out：新的证书请求文件位置</li><li>-config：指定 <code>req</code> 的配置文件</li></ul><p>req.cnf</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 定义输入用户信息选项的&quot;特征名称&quot;字段名，该扩展字段定义了多项用户信息。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">distinguished_name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> req_distinguished_name</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 生成自签名证书时要使用的证书扩展项字段名，该扩展字段定义了要加入到证书中的一系列扩展项。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">x509_extensions</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> v3_req</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 如果设为no，那么 req 指令将直接从配置文件中读取证书字段的信息，而不提示用户输入。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">prompt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> no</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[req_distinguished_name]</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#国家代码，一般都是CN(大写)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">C</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> CN</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#省份</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ST</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> GuangDong</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#城市</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">L</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> GuangZhou</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#企业/单位名称</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">O</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Mango</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#企业部门</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">OU</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Crisp</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#证书的主域名</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">CN</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mangocrisp.gitlab.io</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">##### 要加入到证书请求中的一系列扩展项 #####</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[v3_req]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">keyUsage</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> critical,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> digitalSignature,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> keyAgreement</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">extendedKeyUsage</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> serverAuth</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">subjectAltName</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> @alt_names</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[ alt_names ]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">IP.1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 35.185.44.232</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># IP.2 = 35.185.44.232</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="配置-nginx" tabindex="-1"><a class="header-anchor" href="#配置-nginx"><span>配置 Nginx</span></a></h2><p>执行上面的命令之后会在当前目录生成 server.key 和 server.crt 两个文件，你可以将两个文件放到 nginx 的安装目录/ssl 下</p><h3 id="nginx-conf" tabindex="-1"><a class="header-anchor" href="#nginx-conf"><span>nginx.conf</span></a></h3><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" data-title="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>http {</span></span>
<span class="line"><span>    server {</span></span>
<span class="line"><span>        #监听80端口，强制转到443端口，进行https访问</span></span>
<span class="line"><span>        listen  80;</span></span>
<span class="line"><span>        server_name localhost;    </span></span>
<span class="line"><span>        rewrite ^(.*)$  https://$host$1 permanent;</span></span>
<span class="line"><span>    }    </span></span>
<span class="line"><span>    server {</span></span>
<span class="line"><span>        listen  443 ssl;</span></span>
<span class="line"><span>        server_name  localhost;</span></span>
<span class="line"><span>        # ssl 配置</span></span>
<span class="line"><span>        ssl_session_cache shared:SSL:10m;</span></span>
<span class="line"><span>        ssl_session_timeout 120m;</span></span>
<span class="line"><span>        ssl_prefer_server_ciphers on;</span></span>
<span class="line"><span>        ssl_session_tickets off;</span></span>
<span class="line"><span>        ssl_stapling_verify on;</span></span>
<span class="line"><span>        ssl_certificate     D:/dev/bin/nginx-1.20.2/ssl/server.crt; #证书格式有多种，常见的有pem、cer等</span></span>
<span class="line"><span>        ssl_certificate_key D:/dev/bin/nginx-1.20.2/ssl/server.key;</span></span>
<span class="line"><span>        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span></span>
<span class="line"><span>        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span></span>
<span class="line"><span>        # 其他配置</span></span>
<span class="line"><span>        location / {</span></span>
<span class="line"><span>            root   html;</span></span>
<span class="line"><span>            try_files $uri $uri/ /index.html;</span></span>
<span class="line"><span>            index  index.html index.htm;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>如果有些请求是你一定要配置 http 的，那就得取消强制 https</p></div><h2 id="参考链接" tabindex="-1"><a class="header-anchor" href="#参考链接"><span>参考链接</span></a></h2><p><a href="https://blog.csdn.net/lyfqyr/article/details/124215774" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/lyfqyr/article/details/124215774</a><br><a href="https://www.cnblogs.com/echohye/p/16722833.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/echohye/p/16722833.html</a></p>`,22)]))}const h=i(l,[["render",t],["__file","nginx_ssl.html.vue"]]),d=JSON.parse('{"path":"/ware/soft/nginx_ssl.html","title":"Nginx 配置 ssl","lang":"zh-CN","frontmatter":{"shortTitle":"Nginx 配置 ssl","description":"Nginx 配置 ssl","index":true,"comment":true,"article":true,"timeline":true,"lastUpdated":true,"editLink":true,"contributors":true,"order":-1,"icon":"simple-icons:nginx","isOriginal":false,"date":"2024-09-16T00:00:00.000Z","category":["软/硬件知识"],"tag":["知识","分享","软件知识","Nginx","Https"],"cover":"https://nginx.org/nginx.png","head":[["meta",{"property":"og:url","content":"https://mangocrisp.github.io/ware/soft/nginx_ssl.html"}],["meta",{"property":"og:site_name","content":"Mango Crisp"}],["meta",{"property":"og:title","content":"Nginx 配置 ssl"}],["meta",{"property":"og:description","content":"Nginx 配置 ssl"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://nginx.org/nginx.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-09-15T18:35:10.000Z"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://nginx.org/nginx.png"}],["meta",{"name":"twitter:image:alt","content":"Nginx 配置 ssl"}],["meta",{"property":"article:author","content":"Mango Crisp"}],["meta",{"property":"article:tag","content":"知识"}],["meta",{"property":"article:tag","content":"分享"}],["meta",{"property":"article:tag","content":"软件知识"}],["meta",{"property":"article:tag","content":"Nginx"}],["meta",{"property":"article:tag","content":"Https"}],["meta",{"property":"article:published_time","content":"2024-09-16T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-09-15T18:35:10.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Nginx 配置 ssl\\",\\"image\\":[\\"https://nginx.org/nginx.png\\"],\\"datePublished\\":\\"2024-09-16T00:00:00.000Z\\",\\"dateModified\\":\\"2024-09-15T18:35:10.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Mango Crisp\\",\\"url\\":\\"https://github.com/mangocrisp\\"}]}"]]},"headers":[{"level":2,"title":"生成 ssl 证书","slug":"生成-ssl-证书","link":"#生成-ssl-证书","children":[{"level":3,"title":"Windows 准备","slug":"windows-准备","link":"#windows-准备","children":[]},{"level":3,"title":"Linux 准备","slug":"linux-准备","link":"#linux-准备","children":[]},{"level":3,"title":"openssl","slug":"openssl","link":"#openssl","children":[]}]},{"level":2,"title":"配置 Nginx","slug":"配置-nginx","link":"#配置-nginx","children":[{"level":3,"title":"nginx.conf","slug":"nginx-conf","link":"#nginx-conf","children":[]}]},{"level":2,"title":"参考链接","slug":"参考链接","link":"#参考链接","children":[]}],"git":{"createdTime":1726425310000,"updatedTime":1726425310000,"contributors":[{"name":"yinxijie","email":"yinxijie@gzgxinfo.com","commits":1}]},"readingTime":{"minutes":3.61,"words":1082},"filePathRelative":"ware/soft/nginx_ssl.md","localizedDate":"2024年9月16日","excerpt":"\\n<p>如果你的网站是 Nginx 服务，并且需要访问的时候带上 https，那么就需要在 Nginx 配置 ssl</p>\\n<h2>生成 ssl 证书</h2>\\n<p>Nginx 配置需要证书和密钥，可以去阿里云或者腾讯云等服务商获取证书，一般是申请域名的时候也一并申请证书，这些证书都是互联网可信任的证书，当然，如果你的系统是运行在内网或者一些其他局域网，根本也不需要验证证书的可用性，就是单纯的使用 https，那么，就可以选择自己生成</p>\\n<h3>Windows 准备</h3>\\n<ol>\\n<li>生成证书的方式有很多种，这里默认已经下载了最新的 <a href=\\"https://github.com/git-for-windows/git/releases/download/v2.46.0.windows.1/Git-2.46.0-64-bit.exe\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">Git</a>，就可以使用 <code>Git Bash</code> 下面的功能 <code>openssl</code></li>\\n</ol>"}');export{h as comp,d as data};
