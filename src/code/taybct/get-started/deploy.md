---
# å½“å‰é¡µé¢çš„çŸ­æ ‡é¢˜ï¼Œä¼šåœ¨å¯¼èˆªæ ã€ä¾§è¾¹æ å’Œè·¯å¾„å¯¼èˆªä¸­ä½œä¸ºé¦–é€‰
shortTitle: é¡¹ç›®éƒ¨ç½²
# å½“å‰é¡µé¢å†…å®¹æè¿°
description: é¡¹ç›®éƒ¨ç½²
# æ˜¯å¦åœ¨ä¾§è¾¹æ æˆ–ç›®å½•ä¸­ç´¢å¼•å½“å‰é¡µé¢
index: true
# å½“å‰é¡µé¢æ˜¯å¦å¼€å¯è¯„è®ºåŠŸèƒ½
comment: true
# æ˜¯å¦å°†è¯¥æ–‡ç« æ·»åŠ è‡³æ–‡ç« åˆ—è¡¨ä¸­
article: true
# æ˜¯å¦å°†è¯¥æ–‡ç« æ·»åŠ è‡³æ—¶é—´çº¿ä¸­
timeline: true
# æ˜¯å¦æ˜¾ç¤ºé¡µé¢æœ€åæ›´æ–°æ—¶é—´
lastUpdated: true
# æ˜¯å¦æ˜¾ç¤ºç¼–è¾‘é“¾æ¥
editLink: true
# æ˜¯å¦æ˜¾ç¤ºè´¡çŒ®è€…
contributors: true
# æŒ‡å®šå½“å‰é¡µé¢åœ¨ä¾§è¾¹æ æˆ–ç›®å½•ä¸­çš„æ’åº
order: 5
dir:
  order: 5
# é¡µé¢å›¾æ ‡
icon: "eos-icons:deploy"
# æ˜¯å¦åŸåˆ›
isOriginal: false
# æ—¥æœŸ
date: 2024-09-28
# ç±»åˆ«
category:
  - ä»£ç ç¬”è®°
tag:
  - åç«¯
  - Java
  - SpringBoot
  - "Spring Taybct"
  - å¼€å‘æ¡†æ¶
  - å¿«é€Ÿå¼€å§‹
  - é¡¹ç›®éƒ¨ç½²
# é¡µé¢é¡¶ä¸Šçš„å›¾ç‰‡
#cover: /assets/images/ys/KamisatoAyakaBlack.jpg
---

# é¡¹ç›®éƒ¨ç½²

ä¸€ä¸ªç¨å¾®å¤§ç‚¹çš„é¡¹ç›®ä¸€èˆ¬è¿˜åŒ…æ‹¬äº†ä¼—å¤šçš„ä¸­é—´ä»¶ï¼Œæ‰€ä»¥åœ¨éƒ¨ç½²é¡¹ç›®å‰ï¼Œè¯·å…ˆç¡®ä¿ä¸­é—´ä»¶æ˜¯å¦æ­£å¸¸å®‰è£…[ä¸­é—´ä»¶å®‰è£…å‚è€ƒ](/ware/soft/)ï¼Œå¹¶ä¸”æ­£ç¡®é…ç½®[ç¯å¢ƒå‡†å¤‡](/code/taybct/get-started/environments)

## æ¶æ„å›¾

![æ¶æ„å›¾](/assets/images/taybct/structure.png)

## Single

å•ä½“æ¶æ„éƒ¨ç½²æ¯”è¾ƒç®€å•

1. å°†æ‰“åŒ…å¥½åçš„`jar åŒ…`ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„ä»»æ„ä½ç½®ï¼ˆç¡¬ç›˜ç©ºé—´è¶³å¤Ÿï¼‰
2. åœ¨`jar åŒ…`åŒçº§ç›®å½•ä¸‹åˆ›å»º`config`ç›®å½•ï¼Œç”¨äºå­˜æ”¾é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥å°†é¡¹ç›®çš„`run/src/resources/`ç›®å½•ä¸‹çš„æ‰€æœ‰é…ç½®æ–‡ä»¶éƒ½æ”¾åœ¨è¿™ä¸ªç›®å½•é‡Œé¢
3. åˆ›å»ºè¿è¡Œæ–‡ä»¶
   
## Cloud

å¾®æœåŠ¡æ„æ¶éƒ¨ç½²å’Œå•ä½“ç±»ä¼¼ï¼Œåªä¸è¿‡æ˜¯å¯ä»¥åœ¨å¤šä¸ªæœåŠ¡å™¨ï¼Œæˆ–è€…æ˜¯æœåŠ¡å™¨çš„å¤šä¸ªæ–‡ä»¶å¤¹ï¼Œæˆ–è€…åˆ›å»ºå¤šä¸ªå¯åŠ¨å‘½ä»¤ï¼Œæ¥è¾¾åˆ°åŒæ—¶å¯åŠ¨å¤šä¸ªæœåŠ¡çš„ç›®çš„ï¼Œè¿™åªéœ€è¦é…ç½®å¥½äº†æ³¨å†Œä¸­å¿ƒ(Nacos)å’Œé…ç½®ä¸­å¿ƒ(Nacos)çš„è¿æ¥ä¿¡æ¯å°±è¡Œäº†


å¯åŠ¨å‘½ä»¤ï¼Œç”¨äºå¯åŠ¨æœåŠ¡

## Linux

Linux éƒ¨ç½²è¦æ³¨æ„çš„æ˜¯ï¼Œæ²¡æœ‰å›¾å½¢åŒ–çš„ç•Œé¢ï¼Œæ‰€ä»¥ä¸€å®šè¦åšå¥½è¿ç»´è®°å½•ï¼Œä¸ç„¶åé¢å¾ˆéš¾ç»´æŠ¤

### å¯åŠ¨è„šæœ¬

::: details run.sh

```bash
#!/bin/ash
# æ¸…é™¤ä¹‹å‰è¿è¡Œçš„æ§åˆ¶å°è¾“å‡ºæ—¥å¿—
echo "">run.jar.out
# æŒ‡å®šjdkçš„ java å‘½ä»¤ï¼Œä½ ä¹Ÿå¯ä»¥æŒ‡å®šå¯¹åº”çš„ jdk ç‰ˆæœ¬
java=java
# æ‰“åŒ…å¥½åçš„jaråŒ…åï¼Œæ¯ä¸ªæœåŠ¡çš„ jar åŒ…åä¸ä¸€æ ·
jar=run.jar
# é…ç½® VM å‚æ•°
vm=-Dfile.encoding=utf-8 \
-Dmaven.wagon.http.ssl.insecure=true \
-Dmaven.wagon.http.ssl.allowall=true \
--add-opens java.base/java.util=ALL-UNNAMED \
--add-opens java.base/java.lang=ALL-UNNAMED \
--add-opens java.base/java.lang.reflect=ALL-UNNAMED \
--add-opens java.base/java.lang.invoke=ALL-UNNAMED \
--add-opens java.base/java.lang.io=ALL-UNNAMED
# é…ç½® Jar åŒ…å‚æ•°
params=--spring.profiles.active=test \
--spring.cloud.nacos.discovery.server-addr=127.0.0.1:8848 \
--spring.cloud.nacos.config.server-addr=127.0.0.1:8848 \
--spring.cloud.nacos.username=nacos \
--spring.cloud.nacos.password=nacos \
--server.port=8080
# ç»„åˆæˆå¯åŠ¨å‘½ä»¤ï¼Œåå°è¿è¡Œï¼Œå¹¶ä¸”æŠŠæ§åˆ¶å°æ—¥å¿—è¾“å‡ºåˆ° run.jar.out æ–‡ä»¶
nohup $java $vm -jar $jar $params >run.jar.out 2>&1 &
```
ä½¿ç”¨`nohup`åœ¨åå°è¿è¡Œ`Jar åŒ…`

[å‚è€ƒ1](https://www.runoob.com/linux/linux-comm-nohup.html)
[å‚è€ƒ2](https://blog.csdn.net/weixin_49114503/article/details/134266408)

å¦‚æœä¸æƒ³è¾“å‡ºæ—¥å¿—ï¼Œåªæƒ³åœ¨åå°è¿è¡Œï¼Œå¯ä»¥è¿™æ ·é…ç½®
```bash
nohup $java $vm -jar $jar $params >/dev/null 2>&1 &
```

:::

::: details å…¶ä»–å‚è€ƒè„šæœ¬/å‘½ä»¤

- æŸ¥çœ‹å½“å‰ jar è¿è¡Œçš„ PID
```bash
ps -ef | grep run.jar
```
- æŸ¥çœ‹ç«¯å£è¿è¡Œçš„ PID<Badge text="ä»…rootæƒé™" type="warning"/>
æœ‰çš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦`JaråŒ…`çš„æ—¶å€™ï¼Œå‘ç°ç«¯å£è¢«å ç”¨äº†ï¼Œæƒ³æŸ¥çœ‹ä¸€ä¸‹æ˜¯ä»€ä¹ˆè¿›ç¨‹å ç”¨äº†ï¼Œåªå¯ä»¥ä½¿ç”¨
```bash
netstat -lnp | grep $PORT
```
- å…³é—­è¿è¡Œçš„ jar åŒ…
```bash
# é€šè¿‡ ps æ‰¾åˆ° pid åä½¿ç”¨
kill -9 $PID
```
- æŸ¥çœ‹æ—¥å¿—
tail -f run.jar.out
å¯ä»¥ç›´æ¥æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼Œä¹Ÿå¯ä»¥æŸ¥çœ‹ `./logs/æ¨¡å—å/debug.log` | `./logs/æ¨¡å—å/info.log`  | ``./logs/æ¨¡å—å/warning.log``ï½œ `./logs/æ¨¡å—å/error.log`
- æ¸…é™¤æ—¥å¿—
å¦‚æœç¨‹åºä¸€ç›´è¿è¡Œï¼Œrun.jar.out æ—¥å¿—ä¼šä¸€ç›´ä¸åœçš„å¢é•¿ï¼Œæ‰€ä»¥éœ€è¦å®šæœŸæ¸…ç©ºæ—¥å¿—ï¼Œæ³¨æ„ï¼Œä¸è¦ç›´æ¥åˆ é™¤è¿™ä¸ªæ–‡ä»¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š
```bash
echo "" > run.jar.out
```
æˆ–è€…
```bash
cat /dev/null > nohup.out
```

ä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨`crontab -e`æ¥åˆ›å»ºä¸€ä¸ªç³»ç»Ÿä»»åŠ¡è°ƒåº¦[å‚è€ƒ](https://www.runoob.com/w3cnote/linux-crontab-tasks.html)
```bash
0 0 * * 0 /data/jar/clearlog.sh
```

`clearlog.sh`
```bash
cat /dev/null > nohup.out
```

:::

## Windows

::: tip
`Windows`éƒ¨ç½²å°±æ˜¯æŸ¥çœ‹æ—¥å¿—ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œå¦‚æœå¯ä»¥ï¼Œæ¨èä½ åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…ä¸€ä¸ª[Git](https://git-scm.com/downloads/win),è¿™æ ·å°±å¯ä»¥ä½¿ç”¨`GitBash`çš„[tail](https://www.runoob.com/linux/linux-comm-tail.html)å‘½ä»¤æ¥æŸ¥çœ‹æ—¥å¿—äº†ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥æ–¹ä¾¿åé¢å¦‚æœè¦ä½¿ç”¨[Jenkins](https://www.jenkins.io/zh/)ç­‰å·¥å…·æ¥åšè‡ªåŠ¨åŒ–éƒ¨ç½²çš„æ—¶å€™æ¥å–ä»£ç ï¼Œéå¸¸å¥½ç”¨ğŸ˜˜ğŸ˜˜ğŸ˜˜
:::

### å¯åŠ¨è„šæœ¬

::: details run.bat

```shell
rem é…ç½®æ§åˆ¶å°æ˜¾ç¤ºä¸­æ–‡ï¼ˆé˜²æ­¢ä¹±ç ï¼‰
chcp 65001
rem å¯ä»¥æ˜¾ç¤ºå½“å‰è¿è¡Œçš„ bat ä½ç½®åˆ°é»‘çª—å£ä¸Šé¢ï¼Œæ–¹ä¾¿åç»­æ‰¾åˆ°è¿è¡Œçš„ jar åŒ…çš„ä½ç½®
set TITLE=%0
rem æŒ‡å®šjdkçš„ java å‘½ä»¤ï¼Œä½ ä¹Ÿå¯ä»¥æŒ‡å®šå¯¹åº”çš„ jdk ç‰ˆæœ¬
set java=D:\dev\environment\jdk\jdk-17.0.5\bin\java.exe
rem æ‰“åŒ…å¥½åçš„jaråŒ…åï¼Œæ¯ä¸ªæœåŠ¡çš„ jar åŒ…åä¸ä¸€æ ·
set jar=run.jar
rem é…ç½® VM å‚æ•°
set vm=-Dfile.encoding=utf-8 ^
-Dmaven.wagon.http.ssl.insecure=true ^
-Dmaven.wagon.http.ssl.allowall=true ^
--add-opens java.base/java.util=ALL-UNNAMED ^
--add-opens java.base/java.lang=ALL-UNNAMED ^
--add-opens java.base/java.lang.reflect=ALL-UNNAMED ^
--add-opens java.base/java.lang.invoke=ALL-UNNAMED ^
--add-opens java.base/java.lang.io=ALL-UNNAMED
rem é…ç½® Jar åŒ…å‚æ•°
set params=--spring.profiles.active=test ^
--spring.cloud.nacos.discovery.server-addr=127.0.0.1:8848 ^
--spring.cloud.nacos.config.server-addr=127.0.0.1:8848 ^
--spring.cloud.nacos.username=nacos ^
--spring.cloud.nacos.password=nacos ^
--server.port=8080
rem ç»„åˆæˆå¯åŠ¨å‘½ä»¤
%java% %vm% -jar %jar% %params%
rem è¿™é‡Œæš‚åœä¸€ä¸‹ï¼Œé˜²æ­¢ Jar åŒ…æ²¡å¯åŠ¨èµ·æ¥ï¼Œä½†æ˜¯é»‘çª—å£ä¸€é—ªè€Œè¿‡å¯¼è‡´æ‰¾ä¸åˆ°é”™è¯¯åŸå› 
pause
```

:::

## å¯åŠ¨å‚æ•°è¯´æ˜

::: details å¯åŠ¨å‚æ•°

VM å‚æ•°ï¼š

- `-Dfile.encoding=utf-8`ï¼šé…ç½®å­—ç¬¦é›†ä¸º UTF8
- `-Dmaven.wagon.http.ssl.insecure=true`å’Œ`-Dmaven.wagon.http.ssl.allowall=true`ï¼šé…ç½®å…è®¸SSL
- `--add-opens java.base/**=ALL-UNNAMED`ï¼šæ¨¡å—åŒ–ç³»ç»Ÿé…ç½®ï¼ˆJDK17å¿…é¡»ï¼ŒJDK8å¯ä»¥ä¸é…ç½®ï¼‰

Jar åŒ…å‚æ•°ï¼š

- `--spring.profiles.active=test`ï¼šé…ç½®ç¯å¢ƒï¼ˆæµ‹è¯•ç¯å¢ƒ[test]æˆ–è€…ç”Ÿäº§ç¯å¢ƒ[dev]ï¼‰
- `--spring.cloud.nacos.discovery.server-addr=127.0.0.1:8848` \ `--spring.cloud.nacos.config.server-addr=127.0.0.1:8848` \ `--spring.cloud.nacos.username=nacos` \ `--spring.cloud.nacos.password=nacos`: é…ç½® Nacos è¿æ¥ä¿¡æ¯ï¼ˆå•ä½“æ¶æ„å¯ä»¥ä¸é…ç½®ï¼‰
- `--server.port=8080`ï¼šé…ç½®å¯åŠ¨çš„ Jar åŒ…çš„ç«¯å£å·

:::

::: info æ¨¡å—åŒ–ç³»ç»Ÿé…ç½®
åœ¨JDK 17ä¸­ï¼Œ`java.base`æ¨¡å—æ˜¯`Java`çš„æ ¸å¿ƒæ¨¡å—ä¹‹ä¸€ï¼Œå®ƒåŒ…å«`Java`è¿è¡Œæ—¶æ‰€éœ€çš„åŸºç¡€ç±»ã€‚å¦‚æœå¯åŠ¨æ—¶é‡åˆ°â€œjava.baseæ¨¡å—ä¸å‘æœªå‘½åæ¨¡å—`opens java.*`â€çš„é”™è¯¯ï¼Œé€šå¸¸æ˜¯ç”±äºé…ç½®é—®é¢˜å¯¼è‡´çš„ï¼Œ[å‚è€ƒ](https://developer.baidu.com/article/details/2766430)ï¼Œæ‰€ä»¥æœ‰é‡åˆ°ä¸èƒ½æ­£å¸¸åŠ è½½çš„æ¨¡å—å°±åªéœ€è¦å¾€å¯åŠ¨å‚æ•°é‡Œé¢æ·»åŠ `--add-opens java.base/xxxx=ALL-UNNAMED`å°±è¡Œäº†
:::

::: info å‚æ•°é…ç½®ä¼˜å…ˆçº§
å¦‚æœæ˜¯å¾®æœåŠ¡æ¶æ„ï¼Œæˆ–è€…æ˜¯ä½¿ç”¨äº†é…ç½®ä¸­å¿ƒ(Ncos)é…ç½®å‚æ•°ï¼Œå‚æ•°é…ç½®çš„ä¼˜å…ˆçº§å¦‚ä¸‹ï¼š

nacos > å¯åŠ¨å‚æ•° > application.yml > bootstrap.yml > @Value(${key=value})
:::
